/*! Fingers.js - v0.0.1 - 2014-06-04
 *
 * Copyright (c) 2014 Jérôme HENAFF <jerome.henaff@gmail.com>;
 * Licensed under the MIT license */


!function(a,b){"use strict";var c=function r(a){return new r.Instance(a)};c.__extend=function(a){return Array.prototype.slice.call(arguments,1).forEach(function(b){if(b)for(var c in b)a[c]=b[c]}),a};var d={DIRECTION:{UP:"up",DOWN:"down",LEFT:"left",RIGHT:"right"},GROW:{IN:"in",OUT:"out"},getVelocity:function(a,b){return Math.abs(b/a)||0},getAngle:function(a,b){return Math.atan2(a,b)},getDirection:function(a,b){return Math.abs(a)>=Math.abs(b)?a>0?this.DIRECTION.RIGHT:this.DIRECTION.LEFT:b>0?this.DIRECTION.DOWN:this.DIRECTION.UP},isVertical:function(a){return a===this.DIRECTION.UP||a===this.DIRECTION.DOWN},getDistance:function(a,b){return Math.sqrt(a*a+b*b)}};c.Utils=d;var e=function(){this._cache=[]};e.prototype={_cache:null,isCachedValue:function(a){return this._cache[a]!==b},getCachedValue:function(a){return this._cache[a]},setCachedValue:function(a,b){this._cache[a]=b},clearCachedValue:function(a){delete this._cache[a]},clearCache:function(){this._cache.length=0},getCachedValueOrUpdate:function(a,c,d){var e=this.getCachedValue(a);return e===b&&(e=c.call(d),this.setCachedValue(a,e)),e}},c.CacheArray=e;var f=function(a){this._init(a)};f.HAS_TOUCHEVENTS="ontouchstart"in a,f.IS_MOBILE=/mobile|tablet|ip(ad|hone|od)|android|silk/i.test(navigator.userAgent),f.LISTEN_TOUCH_EVENTS=f.HAS_TOUCHEVENTS&&f.IS_MOBILE,f.prototype={element:null,fingerMap:null,fingerList:null,gestureList:null,_init:function(a){this.element=a,this.fingerMap={},this.fingerList=[],this.gestureList=[],this.startListening()},getElement:function(){return this.element},listenGesture:function(a,b,c){var d=new a(b,c);return this.gestureList.push(d),d},startListening:function(){if(null==this._stopListeningF){var a=this;if(f.LISTEN_TOUCH_EVENTS){var b=this._onTouchStart.bind(this),c=this._onTouchMove.bind(this),d=this._onTouchEnd.bind(this),e=this._onTouchCancel.bind(this);this.element.addEventListener("touchstart",b),this.element.addEventListener("touchmove",c),this.element.addEventListener("touchend",d),this.element.addEventListener("touchcancel",e),this._stopListeningF=function(){a.element.removeEventListener("touchstart",b),a.element.removeEventListener("touchmove",c),a.element.removeEventListener("touchend",d),a.element.removeEventListener("touchcancel",e)}}else{this._onMouseMoveF=this._onMouseMove.bind(this),this._onMouseUpF=this._onMouseUp.bind(this);var g=this._onMouseDown.bind(this);this.element.addEventListener("mousedown",g),this._stopListeningF=function(){a.element.removeEventListener("mousedown",g),document.removeEventListener("mousemove",this._onMouseMoveF),document.removeEventListener("mouseup",this._onMouseUpF)}}}},_stopListeningF:null,stopListening:function(){null!=this._stopListeningF&&(this._removeAllFingers(),this._stopListeningF(),this._stopListeningF=null)},_onTouchStart:function(a){for(var b,c=0,d=a.changedTouches.length;d>c;c++)b=a.changedTouches[c],this._createFinger(b.identifier,a.timeStamp,b.pageX,b.pageY)},_onTouchMove:function(a){for(var b,c=0,d=a.changedTouches.length;d>c;c++)b=a.changedTouches[c],this._updateFingerPosition(b.identifier,a.timeStamp,b.pageX,b.pageY);a.preventDefault()},_onTouchEnd:function(a){for(var b=0,c=a.changedTouches.length;c>b;b++)this._removeFinger(a.changedTouches[b].identifier)},_onTouchCancel:function(a){for(var b=0,c=a.changedTouches.length;c>b;b++)if(null!=this.fingerMap[a.changedTouches[b].identifier]){this._removeAllFingers();break}},_onMouseDown:function(a){0===a.button&&(document.addEventListener("mousemove",this._onMouseMoveF),document.addEventListener("mouseup",this._onMouseUpF),this._createFinger(a.button,a.timeStamp,a.pageX,a.pageY),a.preventDefault())},_onMouseMoveF:null,_onMouseMove:function(a){0===a.button&&this._updateFingerPosition(a.button,a.timeStamp,a.pageX,a.pageY)},_onMouseUpF:null,_onMouseUp:function(){document.removeEventListener("mousemove",this._onMouseMoveF),document.removeEventListener("mouseup",this._onMouseUpF),this._removeFinger(0)},_createFinger:function(a,b,c,d){var e=new g(a,b,c,d);this.fingerMap[e.id]=e,this.fingerList.push(e);for(var f=0,h=this.gestureList.length;h>f;f++)this.gestureList[f]._onFingerAdded(e,this.fingerList)},_removeFinger:function(a){var b=this.fingerMap[a];if(null!=b){for(var c=0,d=this.gestureList.length;d>c;c++)this.gestureList[c]._onFingerRemoved(b);delete this.fingerMap[a],this.fingerList.splice(this._getFingerPosition(b),1)}},_removeAllFingers:function(){for(var a=this.fingerList.splice(0),b=0,c=a.length;c>b;b++)this._removeFinger(a[b].id)},_updateFingerPosition:function(a,b,c,d){var e=this.fingerMap[a];null!=e&&e._setCurrentP(b,c,d)},_getFingerPosition:function(a){return this.fingerList.indexOf(a)}},c.Instance=f;var g=function(a,b,c,d){this.id=a,this._handlerList=[],this.startP=new i(b,c,d),this.previousP=new i(b,c,d),this.currentP=new i(b,c,d),this._cacheArray=new e},h=0;g.cacheIndexes={deltaTime:h++,totalTime:h++,deltaX:h++,deltaY:h++,deltaDistance:h++,totalX:h++,totalY:h++,totalDistance:h++,deltaDirection:h++,totalDirection:h++,velocityX:h++,velocityY:h++,velocity:h++},g.prototype={id:null,startP:null,previousP:null,currentP:null,_cacheArray:null,_handlerList:null,_handlerListSize:0,_addHandler:function(a){this._handlerList.push(a),this._handlerListSize=this._handlerList.length},_removeHandler:function(a){var b=this._handlerList.indexOf(a);this._handlerList.splice(b,1),this._handlerListSize=this._handlerList.length},_setCurrentP:function(a,b,c){this._cacheArray.clearCache(),this.previousP.copy(this.currentP),this.currentP.set(a,b,c);for(var d=0;d<this._handlerListSize;d++)this._handlerList[d](this)},getTime:function(){return this.currentP.timestamp},getDeltaTime:function(){return this._cacheArray.getCachedValueOrUpdate(g.cacheIndexes.deltaTime,this._getDeltaTime,this)},_getDeltaTime:function(){return this.currentP.timestamp-this.previousP.timestamp},getTotalTime:function(){return this._cacheArray.getCachedValueOrUpdate(g.cacheIndexes.startTime,this._getDeltaTime,this)},_getTotalTime:function(){return this.currentP.timestamp-this.startP.timestamp},getX:function(){return this.currentP.x},getY:function(){return this.currentP.y},getDeltaX:function(){return this._cacheArray.getCachedValueOrUpdate(g.cacheIndexes.deltaX,this._getDeltaX,this)},_getDeltaX:function(){return this.currentP.x-this.previousP.x},getDeltaY:function(){return this._cacheArray.getCachedValueOrUpdate(g.cacheIndexes.deltaY,this._getDeltaY,this)},_getDeltaY:function(){return this.currentP.y-this.previousP.y},getDeltaDistance:function(){return this._cacheArray.getCachedValueOrUpdate(g.cacheIndexes.deltaDistance,this._getDeltaDistance,this)},_getDeltaDistance:function(){return d.getDistance(this.getDeltaX(),this.getDeltaY())},getTotalX:function(){return this._cacheArray.getCachedValueOrUpdate(g.cacheIndexes.totalX,this._getTotalX,this)},_getTotalX:function(){return this.currentP.x-this.previousP.x},getTotalY:function(){return this._cacheArray.getCachedValueOrUpdate(g.cacheIndexes.totalY,this._getTotalY,this)},_getTotalY:function(){return this.currentP.y-this.previousP.y},getDistance:function(){return this._cacheArray.getCachedValueOrUpdate(g.cacheIndexes.totalDistance,this._getDistance,this)},_getDistance:function(){return d.getDistance(this.getTotalX(),this.getTotalY())},getDeltaDirection:function(){return this._cacheArray.getCachedValueOrUpdate(g.cacheIndexes.deltaDirection,this._getDeltaDirection,this)},_getDeltaDirection:function(){return d.getDirection(this.getDeltaX(),this.getDeltaY())},getDirection:function(){return this._cacheArray.getCachedValueOrUpdate(g.cacheIndexes.totalDirection,this._getDirection,this)},_getDirection:function(){return d.getDirection(this.getTotalX(),this.getTotalY())},getVelocityX:function(){return this._cacheArray.getCachedValueOrUpdate(g.cacheIndexes.velocityX,this._getVelocityX,this)},_getVelocityX:function(){return d.getVelocity(this.getDeltaTime(),this.getDeltaX())},getVelocityY:function(){return this._cacheArray.getCachedValueOrUpdate(g.cacheIndexes.velocityY,this._getVelocityY,this)},_getVelocityY:function(){return d.getVelocity(this.getDeltaTime(),this.getDeltaY())},getVelocity:function(){return this._cacheArray.getCachedValueOrUpdate(g.cacheIndexes.velocity,this._getVelocity,this)},_getVelocity:function(){return d.getVelocity(this.getDeltaTime(),this.getDeltaDistance())}},c.Finger=g;var i=function(a,b,c){this.set(a,b,c)};i.prototype={timestamp:null,x:null,y:null,set:function(a,b,c){this.timestamp=a,this.x=b,this.y=c},copy:function(a){this.timestamp=a.timestamp,this.x=a.x,this.y=a.y}},c.Position=i;var j=function(a,b,d){this.options=c.__extend({},d||{},a||{}),this._handler=b,this.listenedFingers=[],this._onFingerUpdateF=this._onFingerUpdate.bind(this)};j.EVENT_TYPE={start:"start",end:"end",move:"move"},j.prototype={options:null,_handler:null,isListening:!1,listenedFingers:null,_onFingerAdded:function(){},_onFingerUpdateF:null,_onFingerUpdate:function(){},_onFingerRemoved:function(){},_addListenedFingers:function(){for(var a=0,b=arguments.length;b>a;a++)this._addListenedFinger(arguments[a])},_addListenedFinger:function(a){this.listenedFingers.push(a),a._addHandler(this._onFingerUpdateF),this.isListening||(this.isListening=!0)},_removeListenedFingers:function(){for(var a=0,b=arguments.length;b>a;a++)this._removeListenedFinger(arguments[a])},_removeListenedFinger:function(a){a._removeHandler(this._onFingerUpdateF);var b=this.listenedFingers.indexOf(a);this.listenedFingers.splice(b,1),0==this.listenedFingers.length&&(this.isListening=!1)},_removeAllListenedFingers:function(){for(var a,b=0,c=this.listenedFingers.length;c>b;b++)a=this.listenedFingers[b],a._removeHandler(this._onFingerUpdateF);this.listenedFingers.length=0,this.isListening=!1},isListenedFinger:function(a){return this.isListening&&this.getListenedPosition(a)>-1},getListenedPosition:function(a){return this.listenedFingers.indexOf(a)}},c.Gesture=j,c.gesture={};var k=function(a){function b(b,c){a.call(this,b,c)}return c.__extend(b.prototype,a.prototype,{_onFingerAdded:function(b){this.isListening||(this._addListenedFinger(b),this._handler(a.EVENT_TYPE.start,this.listenedFingers[0]))},_onFingerUpdate:function(){this._handler(a.EVENT_TYPE.move,this.listenedFingers[0])},_onFingerRemoved:function(b){this.isListenedFinger(b)&&(this._handler(a.EVENT_TYPE.end,this.listenedFingers[0]),this._removeAllListenedFingers())}}),b}(c.Gesture);c.gesture.Drag=k;var l=function(a){function b(b,c){a.call(this,b,c,e),this.data={grow:null,scale:1}}var e={nbFingers:1,pinchInDetect:.6,pinchOutDetect:1.4};return c.__extend(b.prototype,a.prototype,{_startDistance:0,data:null,_onFingerAdded:function(a,b){!this.isListening&&b.length>=2&&(this._addListenedFingers(b[0],b[1]),this._startDistance=this._getFingersDistance())},_onFingerUpdate:function(){},_onFingerRemoved:function(b){if(this.isListenedFinger(b)){var c=this._getFingersDistance(),e=c/this._startDistance;(e<=this.options.pinchInDetect||e>=this.options.pinchOutDetect)&&(this.data.grow=e>1?d.GROW.OUT:d.GROW.IN,this.data.scale=e,this._handler(a.EVENT_TYPE.end,this.data,this.listenedFingers)),this._removeAllListenedFingers()}},_getFingersDistance:function(){var a=this.listenedFingers[0].currentP,b=this.listenedFingers[1].currentP;return c.Utils.getDistance(b.x-a.x,b.y-a.y)}}),b}(c.Gesture);c.gesture.Pinch=l;var m=function(a){function b(b,c){a.call(this,b,c)}return c.__extend(b.prototype,a.prototype,{_onFingerAdded:function(b){this._addListenedFinger(b),this._handler(a.EVENT_TYPE.start,b)},_onFingerUpdate:function(b){this._handler(a.EVENT_TYPE.move,b)},_onFingerRemoved:function(b){this.isListenedFinger(b)&&(this._handler(a.EVENT_TYPE.end,b),this._removeAllListenedFingers())}}),b}(c.Gesture);c.gesture.Raw=m;var n=function(a){function b(b,c){a.call(this,b,c),this.data={totalRotation:0,deltaRotation:0}}return c.__extend(b.prototype,a.prototype,{_startAngle:0,_lastAngle:0,data:null,_onFingerAdded:function(b,c){!this.isListening&&c.length>=2&&(this._addListenedFingers(c[0],c[1]),this._handler(a.EVENT_TYPE.start,this.data,this.listenedFingers),this._lastAngle=this._getFingersAngle(),this._startAngle=this._lastAngle)},_onFingerUpdate:function(){var b=this._getFingersAngle();this.data.totalRotation=this._startAngle-b,this.data.deltaRotation=this._lastAngle-b,this._lastAngle=b,this._handler(a.EVENT_TYPE.move,this.data,this.listenedFingers)},_onFingerRemoved:function(b){this.isListenedFinger(b)&&(this._handler(a.EVENT_TYPE.end,this.data,this.listenedFingers),this._removeAllListenedFingers())},_getFingersAngle:function(){var a=this.listenedFingers[0].currentP,b=this.listenedFingers[1].currentP;return c.Utils.getAngle(b.x-a.x,b.y-a.y)}}),b}(c.Gesture);c.gesture.Rotate=n;var o=function(a){function b(b,c){a.call(this,b,c),this.data={totalScale:1,deltaScale:1}}return c.__extend(b.prototype,a.prototype,{_startDistance:0,_lastDistance:0,data:null,_onFingerAdded:function(b,c){!this.isListening&&c.length>=2&&(this._addListenedFingers(c[0],c[1]),this._handler(a.EVENT_TYPE.start,this.data,this.listenedFingers),this._lastDistance=this._getFingersDistance(),this._startDistance=this._lastDistance)},_onFingerUpdate:function(){var b=this._getFingersDistance();this.data.totalScale=b/this._startDistance,this.data.deltaScale=b/this._lastDistance,this._lastDistance=b,this._handler(a.EVENT_TYPE.move,this.data,this.listenedFingers)},_onFingerRemoved:function(b){this.isListenedFinger(b)&&(this._handler(a.EVENT_TYPE.end,this.data,this.listenedFingers),this._removeAllListenedFingers())},_getFingersDistance:function(){var a=this.listenedFingers[0].currentP,b=this.listenedFingers[1].currentP;return c.Utils.getDistance(b.x-a.x,b.y-a.y)}}),b}(c.Gesture);c.gesture.Scale=o;var p=function(a){function b(b,c){a.call(this,b,c,d),this.data={direction:null,velocity:0}}var d={nbFingers:1,swipeVelocityX:.6,swipeVelocityY:.6};return c.__extend(b.prototype,a.prototype,{data:null,_onFingerAdded:function(a,b){if(!this.isListening&&b.length>=this.options.nbFingers)for(var c=0;c<this.options.nbFingers;c++)this._addListenedFinger(b[c])},_onFingerUpdate:function(){},_onFingerRemoved:function(b){if(this.isListenedFinger(b)){for(var c=!0,d=this.listenedFingers[0].getDirection(),e=0,f=0,g=this.listenedFingers.length,h=0;g>h;h++)c=c&&d===this.listenedFingers[h].getDirection(),e+=this.listenedFingers[h].getVelocityX(),f+=this.listenedFingers[h].getVelocityY();e/=g,f/=g,c&&(e>this.options.swipeVelocityX||b.getVelocityY()>this.options.swipeVelocityY)&&(this.data.direction=d,this.data.velocity=e>this.options.swipeVelocityX?e:f,this._handler(a.EVENT_TYPE.end,this.data,this.listenedFingers)),this._removeAllListenedFingers()}}}),b}(c.Gesture);c.gesture.Swipe=p;var q=function(a){function b(b,c){a.call(this,b,c),this.data={totalRotation:0,deltaRotation:0,totalScale:1,deltaScale:1}}return c.__extend(b.prototype,a.prototype,{_startAngle:0,_lastAngle:0,_startDistance:0,_lastDistance:0,data:null,_onFingerAdded:function(b,c){!this.isListening&&c.length>=2&&(this._addListenedFingers(c[0],c[1]),this._handler(a.EVENT_TYPE.start,this.data,this.listenedFingers),this._lastAngle=this._getFingersAngle(),this._startAngle=this._lastAngle,this._lastDistance=this._getFingersDistance(),this._startDistance=this._lastDistance)},_onFingerUpdate:function(){var b=this._getFingersAngle();this.data.totalRotation=this._startAngle-b,this.data.deltaRotation=this._lastAngle-b,this._lastAngle=b;var c=this._getFingersDistance();this.data.totalScale=c/this._startDistance,this.data.deltaScale=c/this._lastDistance,this._lastDistance=c,this._handler(a.EVENT_TYPE.move,this.data,this.listenedFingers)},_onFingerRemoved:function(b){this.isListenedFinger(b)&&(this._handler(a.EVENT_TYPE.end,this.data,this.listenedFingers),this._removeAllListenedFingers())},_getFingersAngle:function(){var a=this.listenedFingers[0].currentP,b=this.listenedFingers[1].currentP;return c.Utils.getAngle(b.x-a.x,b.y-a.y)},_getFingersDistance:function(){var a=this.listenedFingers[0].currentP,b=this.listenedFingers[1].currentP;return c.Utils.getDistance(b.x-a.x,b.y-a.y)}}),b}(c.Gesture);c.gesture.Transform=q,"function"==typeof define&&define.amd?define(function(){return c}):"undefined"!=typeof module&&module.exports?module.exports=c:a.Fingers=c}(window);
//# sourceMappingURL=fingers.min.map