/*! Fingers.js - v0.0.1 - 2014-06-03
 *
 * Copyright (c) 2014 Jérôme HENAFF <jerome.henaff@gmail.com>;
 * Licensed under the MIT license */


!function(a,b){"use strict";var c=function(a){return Array.prototype.slice.call(arguments,1).forEach(function(b){if(b)for(var c in b)a[c]=b[c]}),a},d=function q(a){return new q.Instance(a)},e={DIRECTION:{UP:"up",DOWN:"down",LEFT:"left",RIGHT:"right"},getVelocity:function(a,b){return Math.abs(b/a)||0},getAngle:function(a,b){return Math.atan2(a,b)},getDirection:function(a,b){return Math.abs(a)>=Math.abs(b)?a>0?this.DIRECTION.RIGHT:this.DIRECTION.LEFT:b>0?this.DIRECTION.DOWN:this.DIRECTION.UP},isVertical:function(a){return a===this.DIRECTION.UP||a===this.DIRECTION.DOWN},getDistance:function(a,b){return Math.sqrt(a*a+b*b)}};d.Utils=e;var f=function(){this._cache=[]};f.prototype={_cache:null,isCachedValue:function(a){return this._cache[a]!==b},getCachedValue:function(a){return this._cache[a]},setCachedValue:function(a,b){this._cache[a]=b},clearCachedValue:function(a){delete this._cache[a]},clearCache:function(){this._cache.length=0},getCachedValueOrUpdate:function(a,c,d){var e=this.getCachedValue(a);return e===b&&(e=c.call(d),this.setCachedValue(a,e)),e}},d.CacheArray=f;var g=function(a){this._init(a)};g.HAS_TOUCHEVENTS="ontouchstart"in a,g.IS_MOBILE=/mobile|tablet|ip(ad|hone|od)|android|silk/i.test(navigator.userAgent),g.LISTEN_TOUCH_EVENTS=g.HAS_TOUCHEVENTS&&g.IS_MOBILE,g.prototype={element:null,fingerMap:null,fingerList:null,gestureList:null,_init:function(a){this.element=a,this.fingerMap={},this.fingerList=[],this.gestureList=[],this._listenNativeEvents()},getElement:function(){return this.element},listenGesture:function(a,b,c){var d=new a(b,c);return this.gestureList.push(d),d},_listenNativeEvents:function(){g.LISTEN_TOUCH_EVENTS?(this.element.addEventListener("touchstart",this._onTouchStart.bind(this)),this.element.addEventListener("touchmove",this._onTouchMove.bind(this)),this.element.addEventListener("touchend",this._onTouchEnd.bind(this)),this.element.addEventListener("touchcancel",this._onTouchCancel.bind(this))):(this._onMouseMoveF=this._onMouseMove.bind(this),this._onMouseUpF=this._onMouseUp.bind(this),this.element.addEventListener("mousedown",this._onMouseDown.bind(this)))},_onTouchStart:function(a){for(var b,c=0,d=a.changedTouches.length;d>c;c++)b=a.changedTouches[c],this._createFinger(b.identifier,a.timeStamp,b.pageX,b.pageY)},_onTouchMove:function(a){for(var b,c=0,d=a.changedTouches.length;d>c;c++)b=a.changedTouches[c],this._updateFingerPosition(b.identifier,a.timeStamp,b.pageX,b.pageY);a.preventDefault()},_onTouchEnd:function(a){for(var b=0,c=a.changedTouches.length;c>b;b++)this._removeFinger(a.changedTouches[b].identifier)},_onTouchCancel:function(a){for(var b=0,c=a.changedTouches.length;c>b;b++)if(null!=this.fingerMap[a.changedTouches[b].identifier]){this._removeAllFinger();break}},_onMouseDown:function(a){0===a.button&&(document.addEventListener("mousemove",this._onMouseMoveF),document.addEventListener("mouseup",this._onMouseUpF),this._createFinger(a.button,a.timeStamp,a.pageX,a.pageY),a.preventDefault())},_onMouseMoveF:null,_onMouseMove:function(a){0===a.button&&this._updateFingerPosition(a.button,a.timeStamp,a.pageX,a.pageY)},_onMouseUpF:null,_onMouseUp:function(){document.removeEventListener("mousemove",this._onMouseMoveF),document.removeEventListener("mouseup",this._onMouseUpF),this._removeFinger(0)},_createFinger:function(a,b,c,d){var e=new h(a,b,c,d);this.fingerMap[e.id]=e,this.fingerList.push(e);for(var f=0,g=this.gestureList.length;g>f;f++)this.gestureList[f]._onFingerAdded(this.fingerList)},_removeFinger:function(a){var b=this.fingerMap[a];if(null!=b){for(var c=0,d=this.gestureList.length;d>c;c++)this.gestureList[c]._onFingerRemoved(b);delete this.fingerMap[a],this.fingerList.splice(this._getFingerPosition(b),1)}},_removeAllFinger:function(){for(var a=this.fingerList.splice(0),b=0,c=a.length;c>b;b++)this._removeFinger(a[b].id)},_updateFingerPosition:function(a,b,c,d){var e=this.fingerMap[a];null!=e&&e._setCurrentP(b,c,d)},_getFingerPosition:function(a){return this.fingerList.indexOf(a)}},d.Instance=g;var h=function(a,b,c,d){this.id=a,this._handlerList=[],this.startP=new j(b,c,d),this.previousP=new j(b,c,d),this.currentP=new j(b,c,d),this._cacheArray=new f},i=0;h.cacheIndexes={deltaTime:i++,totalTime:i++,deltaX:i++,deltaY:i++,deltaDistance:i++,totalX:i++,totalY:i++,totalDistance:i++,deltaDirection:i++,totalDirection:i++,velocityX:i++,velocityY:i++,velocity:i++},h.prototype={id:null,startP:null,previousP:null,currentP:null,_cacheArray:null,_handlerList:null,_handlerListSize:0,_addHandler:function(a){this._handlerList.push(a),this._handlerListSize=this._handlerList.length},_removeHandler:function(a){var b=this._handlerList.indexOf(a);this._handlerList.splice(b,1),this._handlerListSize=this._handlerList.length},_setCurrentP:function(a,b,c){this._cacheArray.clearCache(),this.previousP.copy(this.currentP),this.currentP.set(a,b,c);for(var d=0;d<this._handlerListSize;d++)this._handlerList[d]()},getTime:function(){return this.currentP.timestamp},getDeltaTime:function(){return this._cacheArray.getCachedValueOrUpdate(h.cacheIndexes.deltaTime,this._getDeltaTime,this)},_getDeltaTime:function(){return this.currentP.timestamp-this.previousP.timestamp},getTotalTime:function(){return this._cacheArray.getCachedValueOrUpdate(h.cacheIndexes.startTime,this._getDeltaTime,this)},_getTotalTime:function(){return this.currentP.timestamp-this.startP.timestamp},getDeltaX:function(){return this._cacheArray.getCachedValueOrUpdate(h.cacheIndexes.deltaX,this._getDeltaX,this)},_getDeltaX:function(){return this.currentP.x-this.previousP.x},getDeltaY:function(){return this._cacheArray.getCachedValueOrUpdate(h.cacheIndexes.deltaY,this._getDeltaY,this)},_getDeltaY:function(){return this.currentP.y-this.previousP.y},getDeltaDistance:function(){return this._cacheArray.getCachedValueOrUpdate(h.cacheIndexes.deltaDistance,this._getDeltaDistance,this)},_getDeltaDistance:function(){return e.getDistance(this.getDeltaX(),this.getDeltaY())},getTotalX:function(){return this._cacheArray.getCachedValueOrUpdate(h.cacheIndexes.totalX,this._getTotalX,this)},_getTotalX:function(){return this.currentP.x-this.previousP.x},getTotalY:function(){return this._cacheArray.getCachedValueOrUpdate(h.cacheIndexes.totalY,this._getTotalY,this)},_getTotalY:function(){return this.currentP.y-this.previousP.y},getDistance:function(){return this._cacheArray.getCachedValueOrUpdate(h.cacheIndexes.totalDistance,this._getDistance,this)},_getDistance:function(){return e.getDistance(this.getTotalX(),this.getTotalY())},getDeltaDirection:function(){return this._cacheArray.getCachedValueOrUpdate(h.cacheIndexes.deltaDirection,this._getDeltaDirection,this)},_getDeltaDirection:function(){return e.getDirection(this.getDeltaX(),this.getDeltaY())},getDirection:function(){return this._cacheArray.getCachedValueOrUpdate(h.cacheIndexes.totalDirection,this._getDirection,this)},_getDirection:function(){return e.getDirection(this.getTotalX(),this.getTotalY())},getVelocityX:function(){return this._cacheArray.getCachedValueOrUpdate(h.cacheIndexes.velocityX,this._getVelocityX,this)},_getVelocityX:function(){return e.getVelocity(this.getDeltaTime(),this.getDeltaX())},getVelocityY:function(){return this._cacheArray.getCachedValueOrUpdate(h.cacheIndexes.velocityY,this._getVelocityY,this)},_getVelocityY:function(){return e.getVelocity(this.getDeltaTime(),this.getDeltaY())},getVelocity:function(){return this._cacheArray.getCachedValueOrUpdate(h.cacheIndexes.velocity,this._getVelocity,this)},_getVelocity:function(){return e.getVelocity(this.getDeltaTime(),this.getDeltaDistance())}},d.Finger=h;var j=function(a,b,c){this.set(a,b,c)};j.prototype={timestamp:null,x:null,y:null,set:function(a,b,c){this.timestamp=a,this.x=b,this.y=c},copy:function(a){this.timestamp=a.timestamp,this.x=a.x,this.y=a.y}},d.Position=j;var k=function(a,b){this.options=a||{},this._handler=b,this.listenedFingers=[],this._onFingerUpdateF=this._onFingerUpdate.bind(this)};k.EVENT_TYPE={start:"start",end:"end",move:"move"},k.prototype={options:null,_handler:null,_onFingerUpdateF:null,isListening:!1,listenedFingers:null,_onFingerAdded:function(a){this.isListening||this._onFingerAddedImpl(a)},_onFingerAddedImpl:function(){},_onFingerUpdate:function(){},_onFingerRemoved:function(a){this.isListening&&this.listenedFingers.indexOf(a)>-1&&this._onFingerRemovedImpl(a)},_startListeningFingers:function(){for(var a,b=0,c=arguments.length;c>b;b++)a=arguments[b],this.listenedFingers.push(a),a._addHandler(this._onFingerUpdateF);this.isListening=!0},_stopListeningFingers:function(){for(var a,b=0,c=this.listenedFingers.length;c>b;b++)a=this.listenedFingers[b],a._removeHandler(this._onFingerUpdateF);this.listenedFingers.length=0,this.isListening=!1}},d.Gesture=k,d.gesture={};var l=function(a){function b(b,c){a.call(this,b,c)}return c(b.prototype,a.prototype,{_onFingerAddedImpl:function(b){this._startListeningFingers(b[0]),this._handler(a.EVENT_TYPE.start,this.listenedFingers[0])},_onFingerUpdate:function(){this._handler(a.EVENT_TYPE.move,this.listenedFingers[0])},_onFingerRemovedImpl:function(){this._handler(a.EVENT_TYPE.end,this.listenedFingers[0]),this._stopListeningFingers()}}),b}(d.Gesture);d.gesture.Drag=l;var m=function(a){function b(b,c){a.call(this,b,c),this.data={totalScale:1,deltaScale:1}}return c(b.prototype,a.prototype,{_startDistance:0,_lastDistance:0,data:null,_onFingerAddedImpl:function(b){b.length>=2&&(this._startListeningFingers(b[0],b[1]),this._handler(a.EVENT_TYPE.start,1,this.listenedFingers),this._lastDistance=this._getFingersDistance(),this._startDistance=this._lastDistance)},_onFingerUpdate:function(){var b=this._getFingersDistance();this.data.totalScale=b/this._startDistance,this.data.deltaScale=b/this._lastDistance,this._lastDistance=b,this._handler(a.EVENT_TYPE.move,this.data,this.listenedFingers)},_onFingerRemovedImpl:function(){this._handler(a.EVENT_TYPE.end,1,this.listenedFingers),this._stopListeningFingers()},_getFingersDistance:function(){var a=this.listenedFingers[0].currentP,b=this.listenedFingers[1].currentP;return d.Utils.getDistance(b.x-a.x,b.y-a.y)}}),b}(d.Gesture);d.gesture.Pinch=m;var n=function(a){function b(b,c){a.call(this,b,c),this.data={totalRotation:0,deltaRotation:0}}return c(b.prototype,a.prototype,{_startAngle:0,_lastAngle:0,data:null,_onFingerAddedImpl:function(b){b.length>=2&&(this._startListeningFingers(b[0],b[1]),this._handler(a.EVENT_TYPE.start,0,this.listenedFingers),this._lastAngle=this._getFingersAngle(),this._startAngle=this._lastAngle)},_onFingerUpdate:function(){var b=this._getFingersAngle();this.data.totalRotation=this._startAngle-b,this.data.deltaRotation=this._lastAngle-b,this._lastAngle=b,this._handler(a.EVENT_TYPE.move,this.data,this.listenedFingers)},_onFingerRemovedImpl:function(){this._handler(a.EVENT_TYPE.end,0,this.listenedFingers),this._stopListeningFingers()},_getFingersAngle:function(){var a=this.listenedFingers[0].currentP,b=this.listenedFingers[1].currentP;return d.Utils.getAngle(b.x-a.x,b.y-a.y)}}),b}(d.Gesture);d.gesture.Rotate=n;var o=function(a){function b(b,c){a.call(this,b,c)}return b.default={swipeVelocityX:.6,swipeVelocityY:.6},c(b.prototype,a.prototype,{_onFingerAddedImpl:function(a){this._startListeningFingers(a[0])},_onFingerUpdate:function(){},_onFingerRemovedImpl:function(c){var d=this.options.swipeVelocityX||b.default.swipeVelocityX,e=this.options.swipeVelocityY||b.default.swipeVelocityY;(c.getVelocityX()>d||c.getVelocityY()>e)&&this._handler(a.EVENT_TYPE.end,c.getDeltaDirection(),this.listenedFingers[0]),this._stopListeningFingers()}}),b}(d.Gesture);d.gesture.Swipe=o;var p=function(a){function b(b,c){a.call(this,b,c),this.data={totalRotation:0,deltaRotation:0,totalScale:1,deltaScale:1}}return c(b.prototype,a.prototype,{_startAngle:0,_lastAngle:0,_startDistance:0,_lastDistance:0,data:null,_onFingerAddedImpl:function(b){b.length>=2&&(this._startListeningFingers(b[0],b[1]),this._handler(a.EVENT_TYPE.start,0,this.listenedFingers),this._lastAngle=this._getFingersAngle(),this._startAngle=this._lastAngle,this._lastDistance=this._getFingersDistance(),this._startDistance=this._lastDistance)},_onFingerUpdate:function(){var b=this._getFingersAngle();this.data.totalRotation=this._startAngle-b,this.data.deltaRotation=this._lastAngle-b,this._lastAngle=b;var c=this._getFingersDistance();this.data.totalScale=c/this._startDistance,this.data.deltaScale=c/this._lastDistance,this._lastDistance=c,this._handler(a.EVENT_TYPE.move,this.data,this.listenedFingers)},_onFingerRemovedImpl:function(){this._handler(a.EVENT_TYPE.end,0,this.listenedFingers),this._stopListeningFingers()},_getFingersAngle:function(){var a=this.listenedFingers[0].currentP,b=this.listenedFingers[1].currentP;return d.Utils.getAngle(b.x-a.x,b.y-a.y)},_getFingersDistance:function(){var a=this.listenedFingers[0].currentP,b=this.listenedFingers[1].currentP;return d.Utils.getDistance(b.x-a.x,b.y-a.y)}}),b}(d.Gesture);d.gesture.Transform=p,"function"==typeof define&&define.amd?define(function(){return d}):"undefined"!=typeof module&&module.exports?module.exports=d:a.Fingers=d}(window);
//# sourceMappingURL=fingers.min.map