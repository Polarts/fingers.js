/*! Fingers.js - v0.0.1 - 2014-06-03
 *
 * Copyright (c) 2014 Jérôme HENAFF <jerome.henaff@gmail.com>;
 * Licensed under the MIT license */


!function(a){"use strict";var b=function(a){return Array.prototype.slice.call(arguments,1).forEach(function(b){if(b)for(var c in b)a[c]=b[c]}),a},c=function m(a){return new m.Instance(a)},d={DIRECTION:{UP:"up",DOWN:"down",LEFT:"left",RIGHT:"right"},getVelocity:function(a,b){return Math.abs(b/a)||0},getAngle:function(a,b){return Math.atan2(a,b)},getDirection:function(a,b){return Math.abs(a)>=Math.abs(b)?a>0?this.DIRECTION.RIGHT:this.DIRECTION.LEFT:b>0?this.DIRECTION.DOWN:this.DIRECTION.UP},isVertical:function(a){return a===this.DIRECTION.UP||a===this.DIRECTION.DOWN},getDistance:function(a,b){return Math.sqrt(a*a+b*b)}};c.Utils=d;var e=function(a){this._init(a)};e.prototype={element:null,fingerMap:null,fingerList:null,gestureList:null,_init:function(a){this.element=a,this.fingerMap={},this.fingerList=[],this.gestureList=[],this._listenNativeEvents()},getElement:function(){return this.element},listenGesture:function(a,b,c){var d=new a(b,c);return this.gestureList.push(d),d},_listenNativeEvents:function(){this.element.addEventListener("touchstart",this._onTouchStart.bind(this)),this.element.addEventListener("touchend",this._onTouchEnd.bind(this)),this.element.addEventListener("touchcancel",this._onTouchCancel.bind(this)),this.element.addEventListener("touchmove",this._onTouchMove.bind(this))},_onTouchStart:function(a){for(var b,c=0,d=a.changedTouches.length;d>c;c++)b=a.changedTouches[c],this._createFinger(b.identifier,a.timeStamp,b.pageX,b.pageY)},_onTouchEnd:function(a){for(var b=0,c=a.changedTouches.length;c>b;b++)this._removeFinger(a.changedTouches[b].identifier)},_onTouchCancel:function(a){for(var b=0,c=a.changedTouches.length;c>b;b++)if(null!=this.fingerMap[a.changedTouches[b].identifier]){this._removeAllFinger();break}},_onTouchMove:function(a){for(var b,c=0,d=a.changedTouches.length;d>c;c++)b=a.changedTouches[c],this._updateFingerPosition(b.identifier,a.timeStamp,b.pageX,b.pageY);a.preventDefault()},_createFinger:function(a,b,c,d){var e=new f(a,b,c,d);this.fingerMap[e.id]=e,this.fingerList.push(e);for(var g=0,h=this.gestureList.length;h>g;g++)this.gestureList[g]._onFingerAdded(this.fingerList)},_removeFinger:function(a){var b=this.fingerMap[a];if(null!=b){for(var c=0,d=this.gestureList.length;d>c;c++)this.gestureList[c]._onFingerRemoved(b);delete this.fingerMap[a],this.fingerList.splice(this._getFingerPosition(b),1)}},_removeAllFinger:function(){for(var a=this.fingerList.splice(0),b=0,c=a.length;c>b;b++)this._removeFinger(a[b].id)},_updateFingerPosition:function(a,b,c,d){var e=this.fingerMap[a];null!=e&&e._setCurrentP(b,c,d)},_getFingerPosition:function(a){return this.fingerList.indexOf(a)}},c.Instance=e;var f=function(a,b,c,d){this.id=a,this._handlerList=[],this.startP=new g(b,c,d),this.previousP=new g(b,c,d),this.currentP=new g(b,c,d),this._deltaP={deltaTime:0,deltaX:0,deltaY:0}};f.prototype={id:null,startP:null,previousP:null,currentP:null,_deltaP:null,_handlerList:null,_handlerListSize:0,_addHandler:function(a){this._handlerList.push(a),this._handlerListSize=this._handlerList.length},_removeHandler:function(a){var b=this._handlerList.indexOf(a);this._handlerList.splice(b,1),this._handlerListSize=this._handlerList.length},_setCurrentP:function(a,b,c){this.previousP.copy(this.currentP),this.currentP.set(a,b,c),this._deltaP.deltaTime=this.currentP.timestamp-this.previousP.timestamp,this._deltaP.deltaX=this.currentP.x-this.previousP.x,this._deltaP.deltaY=this.currentP.y-this.previousP.y;for(var d=0;d<this._handlerListSize;d++)this._handlerList[d]()},getDeltaTime:function(){return this._deltaP.deltaTime},getDeltaX:function(){return this._deltaP.deltaX},getDeltaY:function(){return this._deltaP.deltaY},getVelocityX:function(){return d.getVelocity(this.getDeltaTime(),this.getDeltaX())},getVelocityY:function(){return d.getVelocity(this.getDeltaTime(),this.getDeltaY())},getDirection:function(){return d.getDirection(this.getDeltaX(),this.getDeltaY())}},c.Finger=f;var g=function(a,b,c){this.set(a,b,c)};g.prototype={timestamp:null,x:null,y:null,set:function(a,b,c){this.timestamp=a,this.x=b,this.y=c},copy:function(a){this.timestamp=a.timestamp,this.x=a.x,this.y=a.y}},c.Position=g;var h=function(a,b){this._options=a,this._handler=b,this.listenedFingers=[],this._onFingerUpdateF=this._onFingerUpdate.bind(this)};h.EVENT_TYPE={start:"start",end:"end",move:"move"},h.prototype={_options:null,_handler:null,_onFingerUpdateF:null,isListening:!1,listenedFingers:null,_onFingerAdded:function(a){this.isListening||this._onFingerAddedImpl(a)},_onFingerAddedImpl:function(){},_onFingerUpdate:function(){},_onFingerRemoved:function(a){this.isListening&&this.listenedFingers.indexOf(a)>-1&&this._onFingerRemovedImpl(a)},_startListeningFingers:function(){for(var a,b=0,c=arguments.length;c>b;b++)a=arguments[b],this.listenedFingers.push(a),a._addHandler(this._onFingerUpdateF);this.isListening=!0},_stopListeningFingers:function(){for(var a,b=0,c=this.listenedFingers.length;c>b;b++)a=this.listenedFingers[b],a._removeHandler(this._onFingerUpdateF);this.listenedFingers.length=0,this.isListening=!1}},c.Gesture=h,c.gesture={};var i=function(a){function c(b,c){a.call(this,b,c)}return b(c.prototype,a.prototype,{_onFingerAddedImpl:function(b){this._startListeningFingers(b[0]),this._handler(a.EVENT_TYPE.start,this.listenedFingers[0])},_onFingerUpdate:function(){this._handler(a.EVENT_TYPE.move,this.listenedFingers[0])},_onFingerRemovedImpl:function(){this._handler(a.EVENT_TYPE.end,this.listenedFingers[0]),this._stopListeningFingers()}}),c}(c.Gesture);c.gesture.Drag=i;var j=function(a){function d(b,c){a.call(this,b,c),this.data={totalRotation:0,deltaRotation:0}}return b(d.prototype,a.prototype,{_startAngle:0,_lastAngle:0,data:null,_onFingerAddedImpl:function(b){b.length>=2&&(this._startListeningFingers(b[0],b[1]),this._handler(a.EVENT_TYPE.start,0,this.listenedFingers),this._lastAngle=this._getFingersAngle(),this._startAngle=this._lastAngle)},_onFingerUpdate:function(){var b=this._getFingersAngle();this.data.totalRotation=this._startAngle-b,this.data.deltaRotation=this._lastAngle-b,this._lastAngle=b,this._handler(a.EVENT_TYPE.move,this.data,this.listenedFingers)},_onFingerRemovedImpl:function(){this._handler(a.EVENT_TYPE.end,0,this.listenedFingers),this._stopListeningFingers()},_getFingersAngle:function(){var a=this.listenedFingers[0].currentP,b=this.listenedFingers[1].currentP;return c.Utils.getAngle(b.x-a.x,b.y-a.y)}}),d}(c.Gesture);c.gesture.Rotate=j;var k=function(a){function d(b,c){a.call(this,b,c),this.data={totalScale:1,deltaScale:1}}return b(d.prototype,a.prototype,{_startDistance:0,_lastDistance:0,data:null,_onFingerAddedImpl:function(b){b.length>=2&&(this._startListeningFingers(b[0],b[1]),this._handler(a.EVENT_TYPE.start,1,this.listenedFingers),this._lastDistance=this._getFingersDistance(),this._startDistance=this._lastDistance)},_onFingerUpdate:function(){var b=this._getFingersDistance();this.data.totalScale=b/this._startDistance,this.data.deltaScale=b/this._lastDistance,this._lastDistance=b,this._handler(a.EVENT_TYPE.move,this.data,this.listenedFingers)},_onFingerRemovedImpl:function(){this._handler(a.EVENT_TYPE.end,1,this.listenedFingers),this._stopListeningFingers()},_getFingersDistance:function(){var a=this.listenedFingers[0].currentP,b=this.listenedFingers[1].currentP;return c.Utils.getDistance(b.x-a.x,b.y-a.y)}}),d}(c.Gesture);c.gesture.Pinch=k;var l=function(a){function d(b,c){a.call(this,b,c),this.data={totalRotation:0,deltaRotation:0,totalScale:1,deltaScale:1}}return b(d.prototype,a.prototype,{_startAngle:0,_lastAngle:0,_startDistance:0,_lastDistance:0,data:null,_onFingerAddedImpl:function(b){b.length>=2&&(this._startListeningFingers(b[0],b[1]),this._handler(a.EVENT_TYPE.start,0,this.listenedFingers),this._lastAngle=this._getFingersAngle(),this._startAngle=this._lastAngle,this._lastDistance=this._getFingersDistance(),this._startDistance=this._lastDistance)},_onFingerUpdate:function(){var b=this._getFingersAngle();this.data.totalRotation=this._startAngle-b,this.data.deltaRotation=this._lastAngle-b,this._lastAngle=b;var c=this._getFingersDistance();this.data.totalScale=c/this._startDistance,this.data.deltaScale=c/this._lastDistance,this._lastDistance=c,this._handler(a.EVENT_TYPE.move,this.data,this.listenedFingers)},_onFingerRemovedImpl:function(){this._handler(a.EVENT_TYPE.end,0,this.listenedFingers),this._stopListeningFingers()},_getFingersAngle:function(){var a=this.listenedFingers[0].currentP,b=this.listenedFingers[1].currentP;return c.Utils.getAngle(b.x-a.x,b.y-a.y)},_getFingersDistance:function(){var a=this.listenedFingers[0].currentP,b=this.listenedFingers[1].currentP;return c.Utils.getDistance(b.x-a.x,b.y-a.y)}}),d}(c.Gesture);c.gesture.Transform=l,"function"==typeof define&&define.amd?define(function(){return c}):"undefined"!=typeof module&&module.exports?module.exports=c:a.Fingers=c}(window);
//# sourceMappingURL=fingers.min.map